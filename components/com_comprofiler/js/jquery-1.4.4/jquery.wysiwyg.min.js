(function(b){function g(a,c){return this instanceof g?this.init(a,c):new g(a,c)}b.fn.document=function(){var a=this[0];return a.nodeName.toLowerCase()=="iframe"?a.contentWindow.document:b(this)};b.fn.wysiwyg=function(a){if(arguments.length>0&&arguments[0].constructor==String){for(var c=arguments[0].toString(),f=[],d=1;d<arguments.length;d++)f[d-1]=arguments[d];return c in g?this.each(function(){g[c].apply(this,f)}):this}d={};if(a&&a.length>0&&a.controls){d=a.controls;delete a.controls}a=b.extend({html:'<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body>INITIAL_CONTENT</body></html>',
debug:false,autoSave:true,controls:{}},a);b.extend(a.controls,g.TOOLBAR,d);return this.each(function(){g(this,a)})};b.extend(g,{insertImage:function(a){var c=b.data(this,"wysiwyg");c.constructor==g&&c.editorDoc.execCommand("insertImage",false,a)},createLink:function(a){var c=b.data(this,"wysiwyg");c.constructor==g&&c.editorDoc.execCommand("createLink",false,a)},TOOLBAR:{bold:{visible:true,tags:["b","strong"],css:{fontWeight:"bold"}},italic:{visible:true,tags:["i","em"],css:{fontStyle:"italic"}},strikeThrough:{visible:false,
tags:["s","strike"],css:{textDecoration:"line-through"}},underline:{visible:false,tags:["u"],css:{textDecoration:"underline"}},separator00:{visible:false,separator:true},justifyLeft:{visible:false,css:{textAlign:"left"}},justifyCenter:{visible:false,tags:["center"],css:{textAlign:"center"}},justifyRight:{visible:false,css:{textAlign:"right"}},justifyFull:{visible:false,css:{textAlign:"justify"}},separator01:{visible:false,separator:true},indent:{visible:false},outdent:{visible:false},separator02:{visible:false,
separator:true},subscript:{visible:false,tags:["sub"]},superscript:{visible:false,tags:["sup"]},separator03:{visible:false,separator:true},undo:{visible:false},redo:{visible:false},separator04:{visible:false,separator:true},insertOrderedList:{visible:false,tags:["ol"]},insertUnorderedList:{visible:false,tags:["ul"]},insertHorizontalRule:{visible:false,tags:["hr"]},separator05:{separator:true},createLink:{visible:true,exec:function(a){if(b.browser.msie)a.editorDoc.execCommand("createLink",true,null);
else{var c=prompt("URL","http://");c&&c.length>0&&a.editorDoc.execCommand("createLink",false,c)}},tags:["a"]},insertImage:{visible:true,exec:function(a){if(b.browser.msie)a.editorDoc.execCommand("insertImage",true,null);else{var c=prompt("URL","http://");c&&c.length>0&&a.editorDoc.execCommand("insertImage",false,c)}},tags:["img"]},separator06:{separator:true},h1mozilla:{visible:b.browser.mozilla,className:"h1",command:"heading",arguments:["h1"],tags:["h1"]},h2mozilla:{visible:b.browser.mozilla,className:"h2",
command:"heading",arguments:["h2"],tags:["h2"]},h3mozilla:{visible:b.browser.mozilla,className:"h3",command:"heading",arguments:["h3"],tags:["h3"]},h1:{visible:!b.browser.mozilla,className:"h1",command:"formatBlock",arguments:["h1"],tags:["h1"]},h2:{visible:!b.browser.mozilla,className:"h2",command:"formatBlock",arguments:["h2"],tags:["h2"]},h3:{visible:!b.browser.mozilla,className:"h3",command:"formatBlock",arguments:["h3"],tags:["h3"]},separator07:{visible:false,separator:true},cut:{visible:false},
copy:{visible:false},paste:{visible:false},separator08:{separator:!b.browser.msie},increaseFontSize:{visible:!b.browser.msie,tags:["big"]},decreaseFontSize:{visible:!b.browser.msie,tags:["small"]},separator09:{separator:true},html:{visible:true,exec:function(a){if(a.viewHTML){a.setContent(b(a.original).val());b(a.original).hide()}else{a.saveContent();b(a.original).show()}a.viewHTML=!a.viewHTML}},removeFormat:{visible:true,exec:function(a){a.editorDoc.execCommand("removeFormat",false,[]);a.editorDoc.execCommand("unlink",
false,[])}}}});b.extend(g.prototype,{original:null,options:{},element:null,editor:null,init:function(a,c){var f=this;this.editor=a;this.options=c||{};b.data(a,"wysiwyg",this);var d=a.width||a.clientWidth,e=a.height||a.clientHeight;if(a.nodeName.toLowerCase()=="textarea"){this.original=a;if(d==0&&a.cols)d=a.cols*8+21;if(e==0&&a.rows)e=a.rows*16+16;var h=this.editor=b("<iframe></iframe>").css({minHeight:(e-6).toString()+"px",width:(d-8).toString()+"px"}).attr("id",b(a).attr("id")+"IFrame");b.browser.msie&&
this.editor.css("height",e.toString()+"px")}var i=this.panel=b("<ul></ul>").addClass("panel");this.appendControls();this.element=b("<div></div>").css({width:d>0?d.toString()+"px":"100%"}).addClass("wysiwyg").append(i).append(b("<div><!-- --\></div>").css({clear:"both"})).append(h);b(a).hide().before(this.element);this.viewHTML=false;this.initialHeight=e-8;this.initialContent=b(a).text();this.initFrame();this.initialContent.length==0&&this.setContent("<br />");this.options.autoSave&&b("form").submit(function(){f.saveContent()})},
initFrame:function(){var a=this;this.editorDoc=b(this.editor).document();this.editorDoc.open();this.editorDoc.write(this.options.html.replace(/INITIAL_CONTENT/,this.initialContent));this.editorDoc.close();this.editorDoc.contentEditable="true";this.editorDoc_designMode=false;try{this.editorDoc.designMode="on";this.editorDoc_designMode=true}catch(c){b(this.editorDoc).focus(function(){if(!a.editorDoc_designMode)try{a.editorDoc.designMode="on";a.editorDoc_designMode=true}catch(f){}})}b(this.editorDoc).click(function(f){a.checkTargets(f.target?
f.target:f.srcElement)});this.options.autoSave&&b(this.editorDoc).keydown(function(){a.saveContent()}).mousedown(function(){a.saveContent()})},getContent:function(){return b(b(this.editor).document()).find("body").html()},setContent:function(a){b(b(this.editor).document()).find("body").html(a)},saveContent:function(){this.original&&b(this.original).val(this.getContent())},appendMenu:function(a,c,f,d){var e=this;c=c||[];b("<li></li>").append(b("<a><!-- --\></a>").addClass(f||a)).mousedown(function(){d?
d(e):e.editorDoc.execCommand(a,false,c);e.options.autoSave&&e.saveContent()}).appendTo(this.panel)},appendMenuSeparator:function(){b('<li class="separator"></li>').appendTo(this.panel)},appendControls:function(){for(var a in this.options.controls){var c=this.options.controls[a];if(c.separator)c.visible!==false&&this.appendMenuSeparator();else if(c.visible)this.appendMenu(c.command||a,c.arguments||[],c.className||c.command||a||"empty",c.exec)}},checkTargets:function(a){for(var c in this.options.controls){var f=
this.options.controls[c],d=f.className||f.command||c||"empty";b("."+d,this.panel).removeClass("active");if(f.tags){var e=a;do{if(e.nodeType!=1)break;b.inArray(e.tagName.toLowerCase(),f.tags)!=-1&&b("."+d,this.panel).addClass("active")}while(e=e.parentNode)}if(f.css){e=b(a);do{if(e[0].nodeType!=1)break;for(var h in f.css)e.css(h).toString().toLowerCase()==f.css[h]&&b("."+d,this.panel).addClass("active")}while(e=e.parent())}}}})})(jQuery);
